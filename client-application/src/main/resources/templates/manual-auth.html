<!DOCTYPE html>
<html>
<head>
    <title>Manual OAuth2 Login</title>
</head>
<body>
<h2>Manual OAuth2 PKCE Flow</h2>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/">PKCE Client</a>
        <div class="navbar-nav ms-auto">
            <span class="navbar-text me-3" th:if="${user}">
                Hello, <span th:text="${user.getAttribute('name') ?: 'User'}"></span>!
            </span>
            <a class="nav-link" href="/dashboard">Dashboard</a>
            <a class="nav-link" href="/profile">Profile</a>

            <!-- Logout Form -->
            <form th:if="${user}" method="post" action="/perform-logout" class="d-inline">
                <button type="submit" class="btn btn-outline-light btn-sm ms-2">Logout</button>
            </form>

            <!-- Or simple logout link -->
            <a th:unless="${user}" class="nav-link" href="/manual-auth">Login</a>
        </div>
    </div>
</nav>
<div>
    <h3>PKCE Details:</h3>
    <p><strong>Code Verifier:</strong> <code th:text="${codeVerifier}"></code></p>
    <p><strong>Code Challenge:</strong> <code th:text="${codeChallenge}"></code></p>
    <p><strong>State:</strong> <code th:text="${state}"></code></p>
</div>

<div>
    <h3>Authorization URL:</h3>
    <a th:href="${authorizationUrl}" target="_blank">
        <button>Start OAuth2 Flow</button>
    </a>
    <p><small th:text="${authorizationUrl}"></small></p>
</div>

<div>
    <h3>Or use Spring Security auto-flow:</h3>
    <a href="/redirect-auth">Auto OAuth2 Flow</a>
</div>
</body>
</html>