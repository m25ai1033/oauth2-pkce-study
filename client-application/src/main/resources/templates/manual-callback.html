<!DOCTYPE html>
<html>
<head>
    <title>OAuth2 Callback</title>
</head>
<body>
<h2>OAuth2 PKCE Flow Complete!</h2>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/">PKCE Client</a>
        <div class="navbar-nav ms-auto">
            <span class="navbar-text me-3" th:if="${user}">
                Hello, <span th:text="${user.getAttribute('name') ?: 'User'}"></span>!
            </span>
            <a class="nav-link" href="/dashboard">Dashboard</a>
            <a class="nav-link" href="/profile">Profile</a>

            <!-- Logout Form -->
            <form th:if="${user}" method="post" action="/perform-logout" class="d-inline">
                <button type="submit" class="btn btn-outline-light btn-sm ms-2">Logout</button>
            </form>

            <!-- Or simple logout link -->
            <a th:unless="${user}" class="nav-link" href="/manual-auth">Login</a>
        </div>
    </div>
</nav>
<div th:if="${tokenResponse}">
    <h3>Token Response:</h3>
    <!-- FIX: Remove .toString() calls -->
    <p><strong>Access Token:</strong> <code th:text="${tokenResponse.access_token}"></code></p>
    <p><strong>Token Type:</strong> <span th:text="${tokenResponse.token_type}"></span></p>
    <p><strong>Expires In:</strong> <span th:text="${tokenResponse.expires_in}"></span> seconds</p>
    <p><strong>Scope:</strong> <span th:text="${tokenResponse.scope}"></span></p>
    <p><strong>ID Token Present:</strong> <span th:text="${tokenResponse.id_token != null}"></span></p>
    <p><strong>Refresh Token Present:</strong> <span th:text="${tokenResponse.refresh_token != null}"></span></p>
</div>

<div>
    <a href="/dashboard">Go to Dashboard</a> |
    <a href="/manual-auth">Start Over</a>
</div>
</body>
</html>